import{r as y,R as fe}from"./index-CmobU_Wg.js";/*!root v1.2.42024年10月Sat Oct 05 2024 10:42:20 GMT+0000 (Coordinated Universal Time)制作*/var Ce={exports:{}},de={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var De=fe,je=Symbol.for("react.element"),Ke=Symbol.for("react.fragment"),$e=Object.prototype.hasOwnProperty,Qe=De.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Fe={key:!0,ref:!0,__self:!0,__source:!0};function Me(e,t,o){var n,s={},a=null,d=null;o!==void 0&&(a=""+o),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(d=t.ref);for(n in t)$e.call(t,n)&&!Fe.hasOwnProperty(n)&&(s[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:je,type:e,key:a,ref:d,props:s,_owner:Qe.current}}de.Fragment=Ke;de.jsx=Me;de.jsxs=Me;Ce.exports=de;var I=Ce.exports;const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}));function xe(e,t){let o=e.length;for(;o--;)if(e[o].pointerId===t.pointerId)return o;return-1}function ye(e,t){let o;if(t.touches){o=0;for(const n of t.touches)n.pointerId=o++,ye(e,n);return}o=xe(e,t),o>-1&&e.splice(o,1),e.push(t)}function We(e,t){if(t.touches){for(;e.length;)e.pop();return}const o=xe(e,t);o>-1&&e.splice(o,1)}function be(e){e=e.slice(0);let t=e.pop(),o;for(;o=e.pop();)t={clientX:(o.clientX-t.clientX)/2+t.clientX,clientY:(o.clientY-t.clientY)/2+t.clientY};return t}function me(e){if(e.length<2)return 0;const t=e[0],o=e[1];return Math.sqrt(Math.pow(Math.abs(o.clientX-t.clientX),2)+Math.pow(Math.abs(o.clientY-t.clientY),2))}let se={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?se={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(se={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function pe(e,t,o,n){se[e].split(" ").forEach(s=>{t.addEventListener(s,o,n)})}function he(e,t,o){se[e].split(" ").forEach(n=>{t.removeEventListener(n,o)})}const Ze=typeof document<"u"&&!!document.documentMode;let Se;function ke(){return Se||(Se=document.createElement("div").style)}const Ae=["webkit","moz","ms"],ae={};function ge(e){if(ae[e])return ae[e];const t=ke();if(e in t)return ae[e]=e;const o=e[0].toUpperCase()+e.slice(1);let n=Ae.length;for(;n--;){const s=`${Ae[n]}${o}`;if(s in t)return ae[e]=s}}function ie(e,t){return parseFloat(t[ge(e)])||0}function le(e,t,o=window.getComputedStyle(e)){const n=t==="border"?"Width":"";return{left:ie(`${t}Left${n}`,o),right:ie(`${t}Right${n}`,o),top:ie(`${t}Top${n}`,o),bottom:ie(`${t}Bottom${n}`,o)}}function ne(e,t,o){e.style[ge(t)]=o}function _e(e,t){const o=ge("transform");ne(e,"transition",`${o} ${t.duration}ms ${t.easing}`)}function Je(e,{x:t,y:o,scale:n,isSVG:s},a){if(ne(e,"transform",`scale(${n}) translate(${t}px, ${o}px)`),s&&Ze){const d=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",d)}}function ue(e){const t=e.parentNode,o=window.getComputedStyle(e),n=window.getComputedStyle(t),s=e.getBoundingClientRect(),a=t.getBoundingClientRect();return{elem:{style:o,width:s.width,height:s.height,top:s.top,bottom:s.bottom,left:s.left,right:s.right,margin:le(e,"margin",o),border:le(e,"border",o)},parent:{style:n,width:a.width,height:a.height,top:a.top,bottom:a.bottom,left:a.left,right:a.right,padding:le(t,"padding",n),border:le(t,"border",n)}}}function He(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function et(e){return(e.getAttribute("class")||"").trim()}function tt(e,t){return e.nodeType===1&&` ${et(e)} `.indexOf(` ${t} `)>-1}function ot(e,t){for(let o=e;o!=null;o=o.parentNode)if(tt(o,t.excludeClass)||t.exclude.indexOf(o)>-1)return!0;return!1}const nt=/^http:[\w\.\/]+svg$/;function rt(e){return nt.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function st(e){const t={};for(const o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t}const Pe={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:Je,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function Oe(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!He(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...Pe,...t};const o=rt(e),n=e.parentNode;n.style.overflow=t.overflow,n.style.userSelect="none",n.style.touchAction=t.touchAction,(t.canvas?n:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,ne(e,"transformOrigin",typeof t.origin=="string"?t.origin:o?"0 0":"50% 50%");function s(){n.style.overflow="",n.style.userSelect="",n.style.touchAction="",n.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",ne(e,"transformOrigin","")}function a(r={}){for(const l in r)r.hasOwnProperty(l)&&(t[l]=r[l]);(r.hasOwnProperty("cursor")||r.hasOwnProperty("canvas"))&&(n.style.cursor=e.style.cursor="",(t.canvas?n:e).style.cursor=t.cursor),r.hasOwnProperty("overflow")&&(n.style.overflow=r.overflow),r.hasOwnProperty("touchAction")&&(n.style.touchAction=r.touchAction,e.style.touchAction=r.touchAction)}let d=0,p=0,c=1,O=!1;b(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{A(t.startX,t.startY,{animate:!1,force:!0})});function S(r,l,f){if(f.silent)return;const h=new CustomEvent(r,{detail:l});e.dispatchEvent(h)}function B(r,l,f){const h={x:d,y:p,scale:c,isSVG:o,originalEvent:f,dimsOut:{}};typeof l.animate=="boolean"&&(l.animate?_e(e,l):ne(e,"transition","none")),l.setTransform(e,h,l);function i(){const m=ue(e);h.dimsOut=m,S(r,h,l),S("panzoomchange",h,l)}return l.animate?setTimeout(()=>{i()},l.duration+50):requestAnimationFrame(()=>{i()}),h}function C(r,l,f,h){const i={...t,...h},m={x:d,y:p,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&c===i.startScale))return m;if(r=parseFloat(r),l=parseFloat(l),i.disableXAxis||(m.x=(i.relative?d:0)+r),i.disableYAxis||(m.y=(i.relative?p:0)+l),i.contain){const u=ue(e),M=u.elem.width/c,U=u.elem.height/c,Q=M*f,J=U*f,W=(Q-M)/2,Z=(J-U)/2;if(i.contain==="inside"){const H=(-u.elem.margin.left-u.parent.padding.left+W)/f,ee=(u.parent.width-Q-u.parent.padding.left-u.elem.margin.left-u.parent.border.left-u.parent.border.right+W)/f;m.x=Math.max(Math.min(m.x,ee),H);const te=(-u.elem.margin.top-u.parent.padding.top+Z)/f,oe=(u.parent.height-J-u.parent.padding.top-u.elem.margin.top-u.parent.border.top-u.parent.border.bottom+Z)/f;m.y=Math.max(Math.min(m.y,oe),te)}else if(i.contain==="outside"){const H=(-(Q-u.parent.width)-u.parent.padding.left-u.parent.border.left-u.parent.border.right+W)/f,ee=(W-u.parent.padding.left)/f;m.x=Math.max(Math.min(m.x,ee),H);const te=(-(J-u.parent.height)-u.parent.padding.top-u.parent.border.top-u.parent.border.bottom+Z)/f,oe=(Z-u.parent.padding.top)/f;m.y=Math.max(Math.min(m.y,oe),te)}}return i.roundPixels&&(m.x=Math.round(m.x),m.y=Math.round(m.y)),m}function w(r,l){const f={...t,...l},h={scale:c,opts:f};if(!f.force&&f.disableZoom)return h;let i=t.minScale,m=t.maxScale;if(f.contain){const u=ue(e),M=u.elem.width/c,U=u.elem.height/c;if(M>1&&U>1){const Q=u.parent.width-u.parent.border.left-u.parent.border.right,J=u.parent.height-u.parent.border.top-u.parent.border.bottom,W=Q/M,Z=J/U;t.contain==="inside"?m=Math.min(m,W,Z):t.contain==="outside"&&(i=Math.max(i,W,Z))}}return h.scale=Math.min(Math.max(r,i),m),h}function A(r,l,f,h){const i=C(r,l,c,f);return d!==i.x||p!==i.y?(d=i.x,p=i.y,B("panzoompan",i.opts,h)):{x:d,y:p,scale:c,isSVG:o,originalEvent:h}}function b(r,l,f){const h=w(r,l),i=h.opts;if(!i.force&&i.disableZoom)return;r=h.scale;let m=d,u=p;if(i.focal){const U=i.focal;m=(U.x/r-U.x/c+d*r)/r,u=(U.y/r-U.y/c+p*r)/r}const M=C(m,u,r,{relative:!1,force:!0});return d=M.x,p=M.y,c=r,B("panzoomzoom",i,f)}function z(r,l){const f={...t,animate:!0,...l};return b(c*Math.exp((r?1:-1)*f.step),f)}function K(r){return z(!0,r)}function x(r){return z(!1,r)}function P(r,l,f,h){const i=ue(e),m={width:i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,height:i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom};let u=l.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,M=l.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;o||(u-=i.elem.width/c/2,M-=i.elem.height/c/2);const U={x:u/m.width*(m.width*r),y:M/m.height*(m.height*r)};return b(r,{...f,animate:!1,focal:U},h)}function R(r,l){r.preventDefault();const f={...t,...l,animate:!1},h=(r.deltaY===0&&r.deltaX?r.deltaX:r.deltaY)<0?1:-1,i=w(c*Math.exp(h*f.step/3),f).scale;return P(i,r,f,r)}function $(r){const l={...t,animate:!0,force:!0,...r};c=w(l.startScale,l).scale;const f=C(l.startX,l.startY,c,l);return d=f.x,p=f.y,B("panzoomreset",l)}let D,T,Y,g,N,E;const X=[];function j(r){if(ot(r.target,t))return;ye(X,r),O=!0,t.handleStartEvent(r),D=d,T=p,S("panzoomstart",{x:d,y:p,scale:c,isSVG:o,originalEvent:r},t);const l=be(X);Y=l.clientX,g=l.clientY,N=c,E=me(X)}function G(r){if(!O||D===void 0||T===void 0||Y===void 0||g===void 0)return;ye(X,r);const l=be(X),f=X.length>1;let h=c;if(f){E===0&&(E=me(X));const i=me(X)-E;h=w(i*t.step/80+N).scale,P(h,l,{animate:!1},r)}(!f||t.pinchAndPan)&&A(D+(l.clientX-Y)/h,T+(l.clientY-g)/h,{animate:!1},r)}function q(r){X.length===1&&S("panzoomend",{x:d,y:p,scale:c,isSVG:o,originalEvent:r},t),We(X,r),O&&(O=!1,D=T=Y=g=void 0)}let F=!1;function k(){F||(F=!0,pe("down",t.canvas?n:e,j),pe("move",document,G,{passive:!0}),pe("up",document,q,{passive:!0}))}function _(){F=!1,he("down",t.canvas?n:e,j),he("move",document,G),he("up",document,q)}return t.noBind||k(),{bind:k,destroy:_,eventNames:se,getPan:()=>({x:d,y:p}),getScale:()=>c,getOptions:()=>st(t),handleDown:j,handleMove:G,handleUp:q,pan:A,reset:$,resetStyle:s,setOptions:a,setStyle:(r,l)=>ne(e,r,l),zoom:b,zoomIn:K,zoomOut:x,zoomToPoint:P,zoomWithWheel:R}}Oe.defaultOptions=Pe;function Re(e,t){const[o,n]=y.useState(0),[s,a]=y.useState(0),d={backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${o+10}px`},p=C=>{const w=C.nativeEvent.offsetX,A=C.nativeEvent.offsetY;n(t?w:A)},c=(C,w)=>(C.stopPropagation(),new Promise(A=>{if(e.lockLine)return;const b=t?C.clientY:C.clientX,z=w||s;let K=z;const x=R=>{let T=((t?R.clientY:R.clientX)-b)/e.scale+z,Y=T;const N=[...t?e.snapsObj.h:e.snapsObj.v].sort((E,X)=>Math.abs(Y-E)-Math.abs(Y-X));N.length&&Math.abs(N[0]-T)<e.snapThreshold/e.scale&&(Y=N[0],T=Y),K=Math.round(T),a(Math.round(T))},P=()=>{document.removeEventListener("mousemove",x),O(K,e.index),A()};document.addEventListener("mousemove",x),document.addEventListener("mouseup",P,{once:!0})})),O=(C,w)=>{const A=t?e.lines.h:e.lines.v;if(S(C))if(typeof w=="number")A.splice(w,1),e.handleLine&&e.handleLine(e.lines);else return;typeof w!="number"&&(A.push(C),e.handleLine&&e.handleLine(e.lines))},S=C=>{const w=t?e.canvasHeight:e.canvasWidth;return C<0||C>w},B=S(s)?"放开删除":`${t?"Y":"X"}: ${s*e.rate}`;return{startValue:s,setStartValue:a,actionStyle:d,labelContent:B,handleMouseMove:p,handleMouseDown:c}}const at=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function it(e,t,o,n,s,a){a?s.moveTo(e,0):s.moveTo(0,e),s.save(),a?s.translate(e+5,n*.2):s.translate(o*.1,e+32),a||s.rotate(-Math.PI/2),s.fillText(Math.round(t).toString(),4,7),s.restore(),a?s.lineTo(e,n):s.lineTo(o,e),s.stroke(),s.closePath(),s.setTransform(1,0,0,1,0,0)}function ce(e,t,o,n,s,a){n.fillStyle=s.fontShadowColor,n.strokeStyle=s.longfgColor,n.save(),n.translate(e,t),a||n.rotate(-Math.PI/2),n.strokeText(String(o),0,0),n.fillText(String(o),0,0),n.restore()}const lt=(e,t,o,n,s,a)=>{const{scale:d,width:p,height:c,ratio:O,palette:S,gridRatio:B,showShadowText:C}=s,{bgColor:w,fontColor:A,fontShadowColor:b,shadowColor:z,longfgColor:K}=S,x=a?s.canvasWidth:s.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(O,O),e.clearRect(0,0,p,c),e.fillStyle=w,e.fillRect(0,0,p,c);const R=at(d)*B*10,$=R*d,D=Math.floor(t/R)*R,T=(D-t)/R*$,Y=t+Math.ceil((a?p:c)/d);if(n){const g=(o-t)*d,N=n*d;if(e.fillStyle=z,a?e.fillRect(g,0,N,c):e.fillRect(0,g,p,N),C)if(a){ce(g,c*.4,Math.round(o),e,S,a);const E=(o+n-t)*d;ce(E,c*.4,Math.round(o+n),e,S,a)}else{ce(p*.4,g,Math.round(o),e,S,a);const E=(o+n-t)*d;ce(p*.4,E,Math.round(o+n),e,S,a)}}e.beginPath(),e.fillStyle=A,e.strokeStyle=K;for(let g=D,N=0;g<Y;g+=R,N++){const E=T+N*$+.5;if(g-R<x&&g>x||g==x){const X=T+N*$+.5+(x-g)*d;it(X,x,p,c,e,a);return}g>=0&&g<=x&&(g==0?a?(e.moveTo(E,0),e.lineTo(E,c)):(e.moveTo(0,E),e.lineTo(p,E)):a?(e.moveTo(E,20),e.lineTo(E,c/1.3)):(e.moveTo(20,E),e.lineTo(p/1.3,E)),e.save(),g==0?a?e.translate(E-15,c*.2):e.translate(p*.3,E-5):a?e.translate(E-12,c*.05):e.translate(p*.05,E+12),a||e.rotate(-Math.PI/2),x-g>R/2&&(!C||n==0||Math.abs(g-o)>R/2&&Math.abs(g-(o+n))>R/2)&&e.fillText(g.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function ut(e,t){let o;return function(){clearTimeout(o),o=setTimeout(()=>{e()},t)}}const ct=({scale:e,rate:t,palette:o,index:n,start:s,vertical:a,value:d,canvasWidth:p,canvasHeight:c,lines:O,isShowReferLine:S,snapThreshold:B,snapsObj:C,lockLine:w,handleLine:A})=>{const[b,z]=y.useState(!1),[K,x]=y.useState(!1),{startValue:P,setStartValue:R,actionStyle:$,handleMouseMove:D,handleMouseDown:T,labelContent:Y}=Re({palette:o,scale:e,snapsObj:C,lines:O,canvasWidth:p,canvasHeight:c,snapThreshold:B,lockLine:w,index:n,value:d,rate:t,handleLine:A},a),g=y.useMemo(()=>P>=s,[s,P,a]),N=y.useMemo(()=>{const{lineType:j,lockLineColor:G,lineColor:q}=o,F=w?G:q??"black",k=w||K?"none":"auto",_=S&&!w?a?"ns-resize":"ew-resize":"default",r=a?"borderTop":"borderLeft",l=(P-s)*e;return{[r]:`1px ${j} ${F}`,pointerEvents:k,cursor:_,[a?"top":"left"]:`${l}px`}},[o,w,K,S,a,P,s,e]),E=y.useCallback(ut(()=>{x(!1)},1e3),[]);y.useEffect(()=>{x(!0),E()},[e]),y.useEffect(()=>{R(d)},[d]);const X=j=>{j.stopPropagation(),w||z(!0)};return I.jsx("div",{style:N,className:"line",onMouseEnter:X,onMouseMove:D,onMouseLeave:()=>z(!1),onMouseDown:T,hidden:!g,children:I.jsx("div",{className:"action",style:$,children:b&&I.jsx("span",{className:"value",children:Y})})})},ft=({scale:e,palette:t,vertical:o,start:n,width:s,height:a,selectStart:d,selectLength:p,canvasWidth:c,canvasHeight:O,rate:S,showShadowText:B,gridRatio:C,onDragStart:w})=>{const A=y.useRef(null),[b,z]=y.useState(null);y.useEffect(()=>{if(A.current){const P=A.current.getContext("2d");z(P)}},[A]),y.useEffect(()=>{A.current&&b&&(A.current.width=s*window.devicePixelRatio,A.current.height=a*window.devicePixelRatio,b.font='11px -apple-system, "Helvetica Neue", ".SFNSText-Regular", "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif',b.lineWidth=1,b.textBaseline="middle")},[b,s,a,window.devicePixelRatio]),y.useEffect(()=>{const P={scale:e/S,width:s,height:a,palette:t,canvasWidth:c*S,canvasHeight:O*S,ratio:window.devicePixelRatio,rate:S,gridRatio:C,showShadowText:B};b&&lt(b,n*S,d,p,P,!o)},[e,S,s,a,t,c,O,window.devicePixelRatio,C,b,n,d,p,o]);const K=y.useMemo(()=>({width:s+"px",height:a+"px",cursor:o?"ew-resize":"ns-resize",[o?"borderRight":"borderBottom"]:`1px solid ${t.borderColor||"#eeeeef"}`}),[o,t.borderColor]),x=P=>w(P);return I.jsx("canvas",{ref:A,className:"ruler",style:K,onMouseDown:x})},dt=y.memo(ft),Ee=({scale:e,thick:t,canvasWidth:o,canvasHeight:n,palette:s,vertical:a,width:d,height:p,start:c,startOther:O,lines:S,selectStart:B,selectLength:C,isShowReferLine:w,rate:A,snapThreshold:b,snapsObj:z,gridRatio:K,lockLine:x,propStyle:P,showShadowText:R,handleLine:$})=>{const[D,T]=y.useState(x),[Y,g]=y.useState(!1),[N,E]=y.useState(!1),{actionStyle:X,handleMouseMove:j,handleMouseDown:G,labelContent:q,startValue:F,setStartValue:k}=Re({palette:s,scale:e,snapsObj:z,lines:S,canvasWidth:o,canvasHeight:n,snapThreshold:b,lockLine:D,rate:A,handleLine:$},!a),_=a?"v-container":"h-container",r=y.useMemo(()=>a?S.h:S.v,[a,S]),l=y.useMemo(()=>{const h=s.lineType;let i=a?"left":"top",m=a?"top":"left",u=a?"borderLeft":"borderBottom";const M=(F-O)*e+t;return{[i]:M+"px",[m]:-t+"px",cursor:a?"ew-resize":"ns-resize",[u]:`1px ${h} ${s.lineColor}`}},[F,O,a,s.lineType,e,s.lineColor,t]),f=async h=>{const{offsetX:i,offsetY:m}=h.nativeEvent;g(!0),T(!1);let u=Math.round(O-t/e+(a?i:m)/e);k(u),await G(h,u),g(!1)};return y.useEffect(()=>{T(x)},[x]),I.jsxs("div",{className:_,style:P,children:[I.jsx(dt,{vertical:a,scale:e,width:d,height:p,start:c,showShadowText:R,canvasWidth:o,canvasHeight:n,selectStart:B,selectLength:C,palette:s,rate:A,onDragStart:f,gridRatio:K}),w&&I.jsx("div",{className:"lines",children:r.map((h,i)=>I.jsx(ct,{lockLine:D,index:i,value:Math.floor(h),scale:e,start:c,canvasWidth:o,snapThreshold:b,snapsObj:z,canvasHeight:n,lines:S,palette:s,vertical:a,isShowReferLine:w,handleLine:$,rate:A},`${h}-${i}`))}),w&&I.jsx("div",{className:"indicator",onMouseEnter:()=>E(!0),onMouseMove:j,onMouseLeave:()=>E(!1),hidden:!Y,style:l,children:I.jsx("div",{className:"action",style:X,children:N&&I.jsx("span",{className:"value",children:q})})})]})},mt=e=>y.useMemo(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...e}),[e]),ht=fe.forwardRef(({showRuler:e=!0,scale:t=1,rate:o=1,thick:n=16,width:s=1400,height:a=800,eyeIcon:d,closeEyeIcon:p,paddingRatio:c=.2,autoCenter:O=!0,showShadowText:S=!0,shadow:B={x:0,y:0,width:0,height:0},lines:C={h:[],v:[]},isShowReferLine:w=!0,canvasWidth:A=1e3,canvasHeight:b=700,snapsObj:z={h:[],v:[]},palette:K,snapThreshold:x=5,gridRatio:P=1,lockLine:R=!1,selfHandle:$=!1,panzoomOption:D,children:T,onHandleCornerClick:Y,updateScale:g,onZoomChange:N,handleLine:E},X)=>{const j=mt(K||{}),[G,q]=y.useState(0),[F,k]=y.useState(0),[_,r]=y.useState("defaultCursor");let l=0,f=0;const[h,i]=y.useState(1),[m,u]=y.useState(w),M=y.useRef(null),U=y.useMemo(()=>s-n,[s,n]),Q=y.useMemo(()=>a-n,[a,n]),J={thick:n,lines:C,snapThreshold:x,snapsObj:z,isShowReferLine:m,canvasWidth:A,canvasHeight:b,rate:o,palette:j,gridRatio:P,showShadowText:S,lockLine:R,scale:h,handleLine:E},W=y.useMemo(()=>({backgroundImage:m?`url(${d||Ge})`:`url(${p||qe})`,width:`${n}px`,height:`${n}px`,borderRight:`1px solid ${j.borderColor}`,borderBottom:`1px solid ${j.borderColor}`}),[m,d,p,j]),Z=y.useMemo(()=>({background:j.bgColor,left:n+"px",top:n+"px",width:U+"px",height:Q+"px"}),[Q,U,j]),H=v=>{(v.ctrlKey||v.metaKey)&&M.current&&M.current.zoomWithWheel(v)},ee=v=>{v.key===" "&&(M.current&&(r("grabCursor"),M.current.bind()),v.preventDefault())},te=v=>{v.key===" "&&M.current&&(r("defaultCursor"),M.current.destroy())},oe=v=>({noBind:!0,startScale:v,startX:l,startY:f,smoothScroll:!0,canvas:!0,...D}),Te=v=>{const V=v.detail,{scale:L,dimsOut:re}=V;if(re){i(L),g&&g(L);const Ve=(re.parent.left-re.elem.left)/L,Ie=(re.parent.top-re.elem.top)/L;q(Ve),N&&N(V),k(Ie)}},ve=()=>{const v=document.querySelector(".canvasedit");let V=t;O&&(V=we(),i(V),g&&g(V));const L=Oe(v,oe(V));M.current=L,v&&v.addEventListener("panzoomchange",Te)},we=()=>{const v=U*(1-c)/A,V=Q*(1-c)/b,L=Math.min(v,V);return l=U/2-A/2,L<1?f=(b*L/2-b/2)/L-(b*L-Q)/L/2:L>1?f=(b*L-b)/2/L+(Q-b*L)/L/2:f=0,L},Ne=()=>{var v;return(v=M.current)==null?void 0:v.reset()},Xe=()=>{var v;return(v=M.current)==null?void 0:v.zoomIn()},Be=()=>{var v;return(v=M.current)==null?void 0:v.zoomOut()},Ye=()=>{var v;let V=we();(v=M.current)==null||v.setOptions(oe(V))},Ue=()=>{u(!m),Y&&Y(!m)};y.useImperativeHandle(X,()=>({reset:Ne,zoomIn:Xe,zoomOut:Be,initPanzoom:ve,panzoomInstance:M})),y.useEffect(()=>{u(w)},[w]),y.useEffect(()=>(ve(),$||(document.addEventListener("wheel",H,{passive:!1}),document.addEventListener("keydown",ee),document.addEventListener("keyup",te)),()=>{document.removeEventListener("wheel",H),document.removeEventListener("keydown",ee),document.removeEventListener("keyup",te)}),[A,b,s,a]),y.useEffect(()=>{Ye()},[D]);const[Le,ze]=fe.Children.toArray(T).reduce((v,V)=>(fe.isValidElement(V)&&(V.props.slot==="default"?v[0]=V:V.props.slot==="btn"&&(v[1]=V)),v),[null,null]);return I.jsxs("div",{className:"StyledRuler",id:"sketch-ruler",children:[ze,I.jsx("div",{className:"canvasedit-parent "+_,style:Z,children:I.jsx("div",{className:"canvasedit "+_,children:Le})}),e&&I.jsx(Ee,{...J,width:s,propStyle:{marginLeft:n+"px",width:U+"px"},height:n,start:G,startOther:F,selectStart:B.x,selectLength:B.width,vertical:!1}),e&&I.jsx(Ee,{...J,propStyle:{marginTop:n+"px",top:0,height:Q+"px"},width:n,height:a,start:F,startOther:G,selectStart:B.y,selectLength:B.height,vertical:!0}),e&&I.jsx("a",{className:"corner",style:W,onClick:Ue})]})});export{ht as S};
